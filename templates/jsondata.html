<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="application/json; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="data:,">
    <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVQI12P4//8/AAX+Av7czFnnAAAAAElFTkSuQmCC">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> -->

    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"> -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>Document</title>
</head>

<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid">
            <a href="#" class="navbar-brand">
                <!-- <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc.<path d="M512 32c0 113.6-84.6 207.5-194.2 222c-7.1-53.4-30.6-101.6-65.3-139.3C290.8 46.3 364 0 448 0h32c17.7 0 32 14.3 32 32zM0 96C0 78.3 14.3 64 32 64H64c123.7 0 224 100.3 224 224v32V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V320C100.3 320 0 219.7 0 96z"/></svg> -->
                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M192 512C86 512 0 426 0 320C0 228.8 130.2 57.7 166.6 11.7C172.6 4.2 181.5 0 191.1 0h1.8c9.6 0 18.5 4.2 24.5 11.7C253.8 57.7 384 228.8 384 320c0 106-86 192-192 192zM96 336c0-8.8-7.2-16-16-16s-16 7.2-16 16c0 61.9 50.1 112 112 112c8.8 0 16-7.2 16-16s-7.2-16-16-16c-44.2 0-80-35.8-80-80z"/></svg>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link active"
                            onclick="onNavigate('/'); return false;">Raw Summary</a></li>
                    <li class="nav-item"><a class="nav-link"
                            onclick="onNavigate('/schedule'); return false;">Schedule</a></li>
                    <li class="nav-item"><a class="nav-link"
                            onclick="onNavigate('/timerset'); return false;">Timer Set</a></li>
                    <li class="nav-item"><a class="nav-link"
                        onclick="onNavigate('/testrelays'); return false;">Test Relays</a></li>
                    <li class="nav-item"><a class="nav-link"
                        onclick="onNavigate('/description'); return false;">Description</a>
                    <li class="nav-item"><a class="nav-link"
                        onclick="onNavigate('/help'); return false;">Help</a>
                </ul>
            </div>
            <div class="clock navbar-text">
                <!-- <h1>NTP Time Display</h1> -->
                <!-- <p>Time from NTP server:  -->
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#ffffff}</style><path d="M256 0a256 256 0 1 1 0 512A256 256 0 1 1 256 0zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg>
                    <span class="ntp-time ">Loading...</span>
                <!-- </p> -->
            </div>
        </div>
    </nav>

    <script>
        const btns = document.querySelectorAll("nav .navbar-nav .nav-link")
        btns.forEach((btn => btn.addEventListener("click", function() {
            btns.forEach(btn => btn.classList.remove("active"))
            this.classList.add("active")
        })))
    </script>

    <div class="container-fluid mt-3">
        <div id="root"></div>

        <div class="timersetrawsummary-top"></div>
        <br />

        <br />
        <div class="channel-btn-container"></div>
        <div class="timerset-container"></div>
        <br />
        <div class="channel-selection-container">

            <!-- <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#home">Home</a></li>
                <li class="nav-item"><a class="nav-link"  data-toggle="tab" href="#about">About</a></li>
                <li class="nav-item"><a class="nav-link"  data-toggle="tab" href="#contact">Contact</a></li>
            </ul>

            <div class="tab-content">
                <div id="home" class="tab-panec active">
                    <h3>Home</h3>
                    <p>Some content</p>
                </div>
                <div id="about" class="tab-pane fade">
                    <h3>About</h3>
                    <p>About content</p>
                </div>
                <div id="contact" class="tab-pane fade">
                    <h3>Contact</h3>
                    <p>Contact content</p>
                </div>
            </div> -->

        </div>
        <!-- <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Home</button>
                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Profile</button>
                <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Contact</button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">home</div>
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">profile</div>
                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">contact</div>
            </div>        -->
        
        <br />
        <div class="timerset2-container-top"></div>
        <br />
        <div class="schedule-container-top"></div>
        <!-- <div class="schedule2-container"></div> -->
        <!-- creating sample data grid and timer summary grid -->

        <div class="relay-container"></div>
    </div>
    <script>

        // channels 
        // c=0 -> col=0,8,16,24,32,40,48
        // c=1 -> col=1,9,17,25,33,41,49
        // c=2 -> col=2,10,18,26,34,42,50
        // c=3 -> col=3,11,19,27,35,43,51
        // c=4 -> col=4,12,20,28,36,44,52
        // c=5 -> col=5,13,21,29,37,45,53
        // c=6 -> col=6,14,22,30,38,46,54
        // c=7 -> col=7,15,23,31,39,47,55
        // d=0 -> col=0,1,2,3,4,5,6,7
        // d=1 -> col=8,9,10,11,12,13,14,15
        // d=2 -> col=16,17,18,19,20,21,22,23
        // d=3 -> col=24,25,26,27,28,29,30,31
        // d=4 -> col=32,33,34,35,36,37,38,39
        // d=5 -> col=40,41,42,43,44,45,46,47
        // d=6 -> col=48,49,50,51,52,53,54,55
        // p=0,1,2,3 -> 4 available periods
        // o=0,1 -> on,off channels

        // need to handle timerSetData between pages and submit. also handle illegal timersetdata i.e. on>off and remove empty timersetdata and a way to delete/clear data/all data w/ confirm button

        myVar = myFunc({{ jsondata| tojson}})
        function myFunc(vars) {
            console.log("myFunc" + vars)
            return vars
        }

        let selectedChannel = "1"
        let timerSetData = myVar.timerSetData   // copy reference.to clone, use structuredClone() or in the past JSON.parse(JSON.stringify())
        let localTimerSetData = { ...myVar.timerSetData }//structuredClone(myVar.timerSetData)

        // first block --- creating timerset raw summary

        function createTimerSetRawSummary2(timerSetData) {
            console.log("create summary")
            const containerTop = document.querySelector(".timersetrawsummary-top")

            const gridContainer = document.createElement("div")
            gridContainer.classList.add("grid-container2-top")

            const gridChannels = document.createElement("div")
            gridChannels.classList.add("grid-channels")
            gridContainer.appendChild(gridChannels)

            for(let i = 0; i < 56; i++) {
                const c = i % 8 + 1
                const gridItem = document.createElement("div")
                gridItem.classList.add("col" + i, "grid-item")
                gridItem.innerHTML = c
                gridChannels.appendChild(gridItem)
            }

            const gridDow = document.createElement("div")
            gridDow.classList.add("grid-dow")
            // containerTop.appendChild(grid)
            gridContainer.appendChild(gridDow)

            const dow = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            dow.forEach((d, i) => {
                const gridItem = document.createElement("div")
                gridItem.classList.add("col" + i, "grid-item")
                gridItem.innerHTML = d
                gridDow.appendChild(gridItem)
            })

            const grid = document.createElement("div")
            grid.classList.add("grid-container2")
            // containerTop.appendChild(grid)
            gridContainer.appendChild(grid)

            for (let c = 0; c < 56; c++) {
                for (let r = 0; r < 8; r++) {
                    const gridItem = document.createElement("div")
                    gridItem.classList.add("grid-item", "row" + r, "col" + c)
                    grid.appendChild(gridItem)
                    const channel = c % 8 + 1
                    const dow = Math.floor(c / 8)
                    const period = Math.floor(r / 2)
                    const onoff = r % 2
                    const pattern = "c" + channel + "d" + dow + "p" + period + "o" + onoff
                    
                    if(timerSetData[pattern]) gridItem.innerHTML = timerSetData[pattern]
                }
            }
            return gridContainer
        }

        // end first block

        // third block --- creating schedule 

        function createTimerSetDivTabs(timerSetData) {
            const tabContainer = document.createElement("ul")
            tabContainer.classList.add("nav","nav-tabs")
            for(let i = 0; i < 8; i++) {
                const tabItem = document.createElement("li")
                // tabItem.classList.add("nav-item", "c" + (i+1) + "on")
                const tabLink = document.createElement("a")
                tabLink.classList.add("nav-link")
                if (i == 0) tabLink.classList.add("active")
                tabLink.innerHTML = "" + (i+1)
                tabLink.addEventListener('click', function(){
                    document.querySelectorAll(".nav-tabs .nav-link").forEach(tab => tab.classList.remove("active"))
                    this.classList.add("active")
                    selectedChannel = this.innerHTML
                    // change input name to reference channel number
                    let inputList = document.querySelectorAll(".timerset-data input")
                    inputList.forEach(input => {
                        input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                        input.classList.value = input.classList.value.replace(/c\d+d/g, 'c' + selectedChannel + 'd')
                        console.log(input.classList)
                    })
                    // change input names to reference to selectedChannel
                    // once selected, load values from timerSetData object

                    inputList.forEach((input) => {
                        try {
                            input.value = localTimerSetData[input.name]
                        } catch (error) {

                        }
                    })

                    let inputDivList = document.querySelectorAll(".timerset-data .grid-item")
                    inputDivList.forEach(div => {
                        div.classList.value = div.classList.value.replace(/c\d+d/g, 'c' + selectedChannel + 'd')
                    })


                    // highlight input errors. reset after switching page
                    inputList.forEach(el => {
                        el.classList.remove("is-invalid")
                        el.classList.remove("is-valid")
                    }) 
                    inputList.forEach((input) => {
                        if(input.value !== '') {
                            console.log(input.name)
                            if(input.name.endsWith("0")) {
                                let prefix = input.name.substring(0,input.name.length-1)
                                const that = document.querySelector("input." + prefix + "1")
                                console.log("input=" + input.value + " and that=" + that.value)
                                if(input.value < that.value) {
                                    console.log("valid")
                                    document.querySelector("input." + input.name).classList.remove("is-invalid")
                                    document.querySelector("input." + that.name).classList.remove("is-invalid")
                                    document.querySelector("input." + input.name).classList.add("is-valid")
                                    document.querySelector("input." + that.name).classList.add("is-valid")
                                }
                                else {
                                    console.log("invalid")
                                    document.querySelector("input." + input.name).classList.remove("is-valid")
                                    document.querySelector("input." + that.name).classList.remove("is-valid")
                                    document.querySelector("input." + input.name).classList.add("is-invalid")
                                    document.querySelector("input." + that.name).classList.add("is-invalid")
                                }
                            } else if(input.name.endsWith("1")) {
                                let prefix = input.name.substring(0,input.name.length-1)
                                const that = document.querySelector("input." + prefix + "0")
                                console.log("input=" + input.value + " and that=" + that.value)
                                if(input.value > that.value) {
                                    console.log("valid")
                                    document.querySelector("input." + input.name).classList.remove("is-invalid")
                                    document.querySelector("input." + that.name).classList.remove("is-invalid")
                                    document.querySelector("input." + input.name).classList.add("is-valid")
                                    document.querySelector("input." + that.name).classList.add("is-valid")
                                }
                                else {
                                    console.log("invalid")
                                    document.querySelector("input." + input.name).classList.remove("is-valid")
                                    document.querySelector("input." + that.name).classList.remove("is-valid")
                                    document.querySelector("input." + input.name).classList.add("is-invalid")
                                    document.querySelector("input." + that.name).classList.add("is-invalid")
                                }
                            }
                        }
                    })

    
                    // // from chatgpt; off all colors
                    // document.querySelectorAll(".timerset2-container .timerset-dow .grid-item, \
                    // .timerset2-container .timerset-start-stop .grid-item, \
                    // .timerset2-container .timerset-control-label .grid-item, \
                    // .timerset2-container .timerset-submit-btn.grid-item").forEach((el) => {
                    //     let classes = el.classList
                    //     for (let i = 0; i < classes.length; i++) {
                    //         if(/^c[1-8]+on$/.test(classes[i])) {
                    //             classes.remove(classes[i])
                    //         }                  
                    //      }
                    //      classes.add("c" + (i+1) + "on")
                    // })

            
                })
                tabItem.appendChild(tabLink)
                tabContainer.appendChild(tabItem)
            }
            const tabDivLabel = document.createElement("div")
            tabDivLabel.classList.add("nav_tab_div_label")
            tabDivLabel.innerHTML = "Channel"
            tabContainer.insertAdjacentElement("afterbegin", tabDivLabel)

            return tabContainer

        }

        function createTimerSetForm2(timerSetData) {
            // create container and insertBefore channel tabs and timerset2-container
            console.log("create timerset form")
            const containerTop = document.querySelector(".timerset2-container-top")
            



            const container = document.createElement("div")
            container.classList.add("container")

            const titlecontainer = document.createElement("div")
            titlecontainer.innerHTML = "<h1>Timer Set</h1>"
            titlecontainer.classList.add("title")
            container.appendChild(titlecontainer)

            
            const timersetDivTabs = document.createElement("div")
            timersetDivTabs.classList.add("timerset-div-tabs")
            timersetDivTabs.appendChild(createTimerSetDivTabs(timerSetData))
            container.appendChild(timersetDivTabs)

            const timersetContainer = document.createElement("div")
            timersetContainer.classList.add("timerset2-container")
            container.appendChild(timersetContainer)

            // containerTop.appendChild(container)

            const timersetForm = document.createElement("form")
            timersetForm.classList.add("form-group")
            timersetContainer.appendChild(timersetForm)

            const timersetControlLabel = document.createElement("div")
            timersetControlLabel.classList.add("timerset-control-label")
            timersetForm.appendChild(timersetControlLabel)

            const timersetDoW = document.createElement("div")
            timersetDoW.classList.add("timerset-dow")
            timersetForm.appendChild(timersetDoW)

            const timersetStartStop = document.createElement("div")
            timersetStartStop.classList.add("timerset-start-stop")
            timersetForm.appendChild(timersetStartStop)

            const timersetData = document.createElement("div")
            timersetData.classList.add("timerset-data")
            timersetForm.appendChild(timersetData)

            const gridItem = document.createElement("div")
            gridItem.classList.add("grid-item")
            timersetControlLabel.appendChild(gridItem)
            gridItem.innerHTML = "Control"

            const timersetSubmitBtn = document.createElement("div")
            timersetSubmitBtn.classList.add("timerset-submit-btn", "grid-item")
            timersetForm.appendChild(timersetSubmitBtn)

            const dow = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            dow.forEach((d, i) => {
                const gridItem = document.createElement("div")
                gridItem.classList.add("col" + i, "grid-item")
                gridItem.innerHTML = d
                timersetDoW.appendChild(gridItem)
            })

            for (let i = 0; i < 8; i++) {
                const div = document.createElement("div")
                timersetStartStop.appendChild(div)
                div.classList.add("row" + (i), "grid-item")
                const p = Math.floor(i/2) + 1
                if (i % 2 == 0) div.innerHTML = "Start Period " + p
                if (i % 2 == 1) div.innerHTML = "Stop Period " + p
            }

            for (let c = 0; c < 7; c++) {
                for (let r = 0; r < 8; r++) {
                    const gridItem = document.createElement("div")
                    gridItem.classList.add("col" + c, "row" + r, "grid-item")

                    timersetData.appendChild(gridItem)

                    const input = document.createElement("input")
                    input.classList.add("input-sm", "form-control")
                    gridItem.appendChild(input)
                    input.type = "time"
                    let _c = selectedChannel
                    let _d = c
                    let _p = Math.floor(r / 2)
                    let _o = r % 2
                    if ((_o == 0)) {
                        input.name = "c" + _c + "d" + _d + "p" + _p + "o0"
                        input.classList.add("c" + _c + "d" + _d + "p" + _p + "o0")
                        gridItem.classList.add("c" + _c + "d" + _d + "p" + _p + "o0")
                    } else {
                        input.name = "c" + _c + "d" + _d + "p" + _p + "o1"
                        input.classList.add("c" + _c + "d" + _d + "p" + _p + "o1")
                        gridItem.classList.add("c" + _c + "d" + _d + "p" + _p + "o1")
                    }
                    input.classList.add("c" + _c + "d" + _d + "p" + _p)
                    gridItem.classList.add("c" + _c + "d" + _d + "p" + _p)

                    // should save in localStorage first. otherwise, updateSchedule (when switching tabs) will show changed values.
                    // what is desirable is that schedule only shows submitted values 
                    input.addEventListener('change', function () {
                        console.log("change")
                        console.log(timerSetData)
                        console.log(this.name + " = " + this.value)
                        // check no empty values, check valid vale and on off range
                        // timerSetData[this.name] = this.value
                        if(this.value !== '')
                            localTimerSetData[this.name] = this.value
                        else
                            delete localTimerSetData[this.name]
                        // check ...o1 > ...o0

                        // need to show on createform too...
                        if(this.value !== '') {
                            console.log(this.name)
                            if(this.name.endsWith("0")) {
                                let prefix = this.name.substring(0,this.name.length-1)
                                const that = document.querySelector("input." + prefix + "1")
                                console.log("this=" + this.value + " and that=" + that.value)
                                if(this.value < that.value) {
                                    console.log("valid")
                                    document.querySelector("input." + this.name).classList.remove("is-invalid")
                                    document.querySelector("input." + that.name).classList.remove("is-invalid")
                                    document.querySelector("input." + this.name).classList.add("is-valid")
                                    document.querySelector("input." + that.name).classList.add("is-valid")
                                }
                                else {
                                    console.log("invalid")
                                    document.querySelector("input." + this.name).classList.remove("is-valid")
                                    document.querySelector("input." + that.name).classList.remove("is-valid")
                                    document.querySelector("input." + this.name).classList.add("is-invalid")
                                    document.querySelector("input." + that.name).classList.add("is-invalid")
                                }
                            } else if(this.name.endsWith("1")) {
                                let prefix = this.name.substring(0,this.name.length-1)
                                const that = document.querySelector("input." + prefix + "0")
                                console.log("this=" + this.value + " and that=" + that.value)
                                if(this.value > that.value) {
                                    console.log("valid")
                                    document.querySelector("input." + this.name).classList.remove("is-invalid")
                                    document.querySelector("input." + that.name).classList.remove("is-invalid")
                                    document.querySelector("input." + this.name).classList.add("is-valid")
                                    document.querySelector("input." + that.name).classList.add("is-valid")
                                }
                                else {
                                    console.log("invalid")
                                    document.querySelector("input." + this.name).classList.remove("is-valid")
                                    document.querySelector("input." + that.name).classList.remove("is-valid")
                                    document.querySelector("input." + this.name).classList.add("is-invalid")
                                    document.querySelector("input." + that.name).classList.add("is-invalid")
                                }
                            }
                        }
                    })


                    // initialization - fill relevant input with timerset data (check initChannelButtons())
                    try {
                        input.value = timerSetData[input.name]
                        // console.log(timerSetData)
                    } catch (error) {

                    }
                }
            }

            const submitElement = document.createElement("button")
            submitElement.name = "submitBtn"
            submitElement.classList.add("submitBtn", "btn", "btn-light")
            submitElement.innerHTML = "Enter"

            timersetSubmitBtn.appendChild(submitElement)

            submitElement.onclick = (e) => postData(e)

            function postData(e) {
                // alert("clicked button, channel=" + selectedChannel)
                e.preventDefault()

                // check validity of input. if ok, post, else, prompt for correction

                if(!checkInputValidity(localTimerSetData)) return

                // if valid, should copy localTimerSetData (which keeps local data) into timerSetData and posted to server, instead of myVar.timerSetData

                // Object.keys(localTimerSetData).forEach((key) => timerSetData[key] = localTimerSetData[key])
                // timerSetData =  { ...myVar.timerSetData } //structuredClone(localTimerSetData)
                // console.log(timerSetData)
                // ensure there are no empty input
                // Object.entries(timerSetData).filter(([k,v]) => v !== '' )
                // localTimerSetData = {}  // reset
                timerSetData =  { ...localTimerSetData }

                fetch("/", { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ "timerSetData": timerSetData }) // should submit localStorage values
                })
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data); 
                        myVar.timerSetData = data.jsondata.timerSetData;
                        localTimerSetData = { ...myVar.timerSetData }//structuredClone(myVar.timerSetData) or Object.assign({},myVar.timerSetData)
                        timerSetData = myVar.timerSetData
                        // mydata2 = data;
                        // populateScheduleData(timerSetData)
                        // updateSchedule(timerSetData)    // doesn't work when div.schedule-container not mounted
                        ntptime = data.ntptime
                    })
                    .catch(error => console.error(error))
                
            }
            // compliments of chatgpt
            function checkInputValidity(timerSetData) {
                let valid=1
                // document.querySelectorAll(".timerset-data .grid-item").forEach(el => el.classList.remove("highlight"))

                const groupEntries = {}
                let prefixes = [] //"c1d0p1"
                // Group entries by their prefixes
                Object.keys(timerSetData).forEach(key => {
                    const keyPrefix = key.match(/^c\d+d\d+p\d+/)[0]
                    if(!groupEntries[keyPrefix]) {
                        groupEntries[keyPrefix] = []
                    }
                    groupEntries[keyPrefix].push({key, value: timerSetData[key]})
                    prefixes.push(keyPrefix)
                })

                prefixes = prefixes.filter((v,i,self)=>i==self.indexOf(v))
                console.log(prefixes)

                prefixes.forEach(prefix => {
                    const [c,d,p,o] = prefix.split(/c(\d+)d(\d+)p(\d+)/).filter(n=>n)

                    const entries = groupEntries[prefix]
                    if(!entries) {
                        console.log(`No entries with prefix "${prefix}" found`)
                        return
                    }

                    if(entries.length >= 2) {
                        for (let i = 0; i < entries.length - 1; i++) {
                            for (let j = i + 1; j < entries.length; j++) {
                                const entry1 = entries[i];
                                const entry2 = entries[j];
                                console.log(entry1)
                                console.log(entry2)
                                if(entry1.value < entry2.value) {
                                    console.log("valid")
                                    // valid = 1
                                }
                                else {
                                    console.log("invalid")
                                    const col1 = d
                                    const col2 = d
                                    const row1 = +p * 2
                                    const row2 = +p * 2 + 1 
                                    console.log(col1)
                                    console.log(col2)
                                    console.log(row1)
                                    console.log(row2)
                                    console.log(entry1.key)
                                    // document.querySelector(".col" + col1 + ".row" + row1).classList.add("highlight")
                                    // document.querySelector(".col" + col2 + ".row" + row2).classList.add("highlight")
                                    // document.querySelector("." + entry1.key).classList.add("highlight")
                                    // document.querySelector("." + entry2.key).classList.add("highlight")
                                    // return false
                                    valid=0
                                }
                            }
                        }
                    } else {
                        console.log(`Not enough matching entries with prefix "${prefix}"`)
                    }
                })
                if(!valid) return false
                return true
            }

            return container
        }

        function updateSchedule(timerSetData) {
            console.log("update schedule")
            console.log(timerSetData)
            const keys = Object.keys(timerSetData)
            const object = timerSetData

            // from chatgpt; off all colors
            document.querySelectorAll(".schedule-container .schedule-data .grid-item").forEach((el) => {
                let classes = el.classList
                for (let i = 0; i < classes.length; i++) {
                    if(/^c[1-8]+on$/.test(classes[i])) {
                        classes.remove(classes[i])
                    }                  
                }
            })

            for (let i = 0; i < keys.length; i+=2) {
                const on = timerSetData[keys[i]];
                const off = timerSetData[keys[i+1]];
                const [c,d,p,o] = keys[i].split(/c(\d+)d(\d+)p(\d+)o(\d+)/).filter(n=>n)
                const col = (+d-0)*8+ +c-1
                if(on<off) {
                    console.log("on<off")
                    const [on_hr,on_min] = on.split(":")
                    const [off_hr,off_min] = off.split(":")
                    const rowStart = on_hr * 2 + (on_min > 0 ? 1 : 0)   // 30 min interval
                    const rowStop = off_hr * 2 + (off_min > 0 ? 1 : 0)   // 30 min interval
                    for (let row = rowStart; row < rowStop; row++) {
                        console.log("update class: row=" + row + ",col=" + col)
                        // doesn't work when div.schedule-container not mountee
                        // console.log("update:" + row +"," + col + "," + on + "," + off)
                        document.querySelector(".schedule-container .row"+row+".col"+col).classList.remove("coff")
                        document.querySelector(".schedule-container .row"+row+".col"+col).classList.add("c"+c+"on")
                    }
                }
            }
        }

        function createSchedule(timerSetData) {
            console.log("create schedule")
            const containerTop = document.querySelector(".schedule-container-top")

            const container = document.createElement("div")
            container.classList.add("container")

            const titlecontainer = document.createElement("div")
            titlecontainer.innerHTML = "<h1>Schedule</h1>"
            titlecontainer.classList.add("title")
            container.appendChild(titlecontainer)

            const schedulecontainer = document.createElement("div")
            schedulecontainer.classList.add("schedule-container")
            // containerTop.appendChild(container)
            container.appendChild(schedulecontainer)

            const scheduleTimeLabel = document.createElement("div")
            scheduleTimeLabel.classList.add("schedule-time-label")
            schedulecontainer.appendChild(scheduleTimeLabel)

            const scheduleDoW = document.createElement("div")
            scheduleDoW.classList.add("schedule-dow")
            schedulecontainer.appendChild(scheduleDoW)

            const scheduleTime = document.createElement("div")
            scheduleTime.classList.add("schedule-time")
            schedulecontainer.appendChild(scheduleTime)

            const scheduleData = document.createElement("div")
            scheduleData.classList.add("schedule-data")
            schedulecontainer.appendChild(scheduleData)

            const gridItem = document.createElement("div")
            gridItem.classList.add("grid-item")
            scheduleTimeLabel.appendChild(gridItem)
            gridItem.innerHTML = "Time"

            const dow = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            dow.forEach((d, i) => {
                const gridItem = document.createElement("div")
                gridItem.classList.add("col" + i, "grid-item")
                gridItem.innerHTML = d
                scheduleDoW.appendChild(gridItem)
            })

            for (let t = 0; t < 48; t++) {
                const timeStr = Math.floor(t / 2).toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false }) + ":" + (t % 2 == 0 ? "00" : "30")
                const gridItem = document.createElement("div")
                gridItem.classList.add("row" + t, "grid-item")
                gridItem.innerHTML = timeStr
                scheduleTime.appendChild(gridItem)
            }
            try{
            const keys = Object.keys(timerSetData)
            const timerSetDataLength = keys.length
            } catch (error) {

            }

            for (let c = 0; c < 56; c++) {
                const channel = c % 8 + 1
                const dow = Math.floor(c / 8)
                const pattern = "c" + channel + "d" + dow

                try {
                filteredData = filterData(timerSetData, pattern)
                const filteredDataKeys = Object.keys(filteredData)
                const filteredDataLength = Object.keys(filteredData).length
                } catch (error) {

                }
                // console.log(pattern + ", " + Object.keys(filteredData).length)
                for (let r = 0; r < 48; r++) {
                    const gridItem = document.createElement("div")
                    gridItem.classList.add("grid-item")
                    gridItem.classList.add("row" + r, "col" + c)
                    gridItem.classList.add("coff")
                    // gridItem.on // wanted to on hover, show timer setting ?
                    // gridItem.innerHTML = channel
                    scheduleData.appendChild(gridItem)
                    try {
                        if (filteredDataLength > 0) {
                            for (let i = 0; i < filteredDataLength; i = i + 2) {
                                const on = filteredData[filteredDataKeys[i]]
                                const off = filteredData[filteredDataKeys[i + 1]]
                                const timeStr = Math.floor(r / 2).toLocaleString('en-US', {
                                    minimumIntegerDigits: 2, useGrouping: false
                                }) + ":" + (r % 2 == 0 ? "00" : "30")

                                if (timeStr >= on && timeStr < off) {
                                    gridItem.classList.add("c" + channel + "on")
                                    gridItem.classList.remove("coff")
                                }
                            }
                        }
                    } catch (error) {
                        
                    }
                }
            }

            function filterData(inputData, substringToMatch) {

                // const inputData = {
                //     "timerSetData": {
                //         "c1d1p0o0": "08:00",
                //         "c1d1p0o1": "09:09",
                //         "c1d1p1o0": "10:00",
                //         "c1d1p1o1": "11:00",
                //         "c1d1p2o0": "11:00",
                //         "c1d1p2o1": "15:00",
                //         "c2d4p0o0": "04:00",
                //         "c2d4p0o1": "06:00",
                //         "c4d3p0o0": "07:00",
                //         "c4d3p0o1": "09:00",
                //         "c4d3p1o0": "17:00",
                //         "c4d3p1o1": "18:09"
                //     }
                // }
                // const substringToMatch = "c4d3"

                const filteredEntries = Object.entries(myVar.timerSetData).filter(([key, _]) => key.includes(substringToMatch))

                const filteredData = Object.fromEntries(filteredEntries)

                // console.log(filteredData)

                return filteredData
            }
            return container
        }

        function createTestRelays() {
            // relay duration timer
            let timers = []

            console.log("createTestRelays")
            const container = document.createElement("div")
            container.classList.add("container")

            const titlecontainer = document.createElement("div")
            titlecontainer.innerHTML = "<h1>Test Relays</h1>"
            titlecontainer.classList.add("title")
            container.appendChild(titlecontainer)

            resetBtnDiv = document.createElement("div")
            resetBtnDiv.classList.add("resetBtnDiv")
            // pageResetBtnDiv.innerHTML = "On/Off"
            container.appendChild(resetBtnDiv)
   
            const resetBtn = document.createElement("button")
            resetBtn.name = "resetBtn"
            resetBtn.classList.add("resetBtn", "btn", "btn-danger")
            resetBtn.innerHTML = "Reset"
            resetBtn.addEventListener("click", () => {
                    document.querySelectorAll(".testrelays input").forEach((el) => {
                        el.checked = false
                    })
                    document.querySelectorAll(".testrelays .duration").forEach((el) => {
                        el.innerHTML = "0 seconds"
                    })
                    for(let i = 0; i < timers.length; i++) {
                        clearInterval(timers[i])
                    }
            })
            resetBtnDiv.appendChild(resetBtn)



            const relayBtnContainer = document.createElement("div")
            relayBtnContainer.classList.add("container","testrelays")
            container.appendChild(relayBtnContainer)

            for (let i = 0; i < 8; i++) {
                const relayBtnRow = document.createElement("div")
                relayBtnRow.classList.add("row")

                const colDiv1 = document.createElement("div")
                colDiv1.classList.add("col-sm-6")
                relayBtnRow.appendChild(colDiv1)
                const colDiv2 = document.createElement("div")
                colDiv2.classList.add("col-sm-3")
                relayBtnRow.appendChild(colDiv2)
                const colDiv3 = document.createElement("div")
                colDiv3.classList.add("col-sm-3")
                relayBtnRow.appendChild(colDiv3)
                relayBtnContainer.appendChild(relayBtnRow)
                

                const c = i + 1

                const label = document.createElement("h6")
                label.innerHTML = "Channel " + c
                colDiv1.appendChild(label)


                const relayInput = document.createElement("input")
                relayInput.setAttribute("type","checkbox")
                // if (c == 1) relayInput.checked = true

                const relaySpan = document.createElement("span")
                relaySpan.classList.add("slider","round")

                const relaySwitch = document.createElement("div")
                relaySwitch.classList.add("switch","sw"+c)

                const relayLabel = document.createElement("label")
                relayLabel.appendChild(relayInput)
                // relayLabel.classList.add("switch")
                relayLabel.appendChild(relaySpan)


                relayInput.addEventListener("click", function() {
                    if(this.checked)
                        state = 1
                    else 
                        state = 0
                    actuateRelay(c, state)

                    if(this.checked) {
                            timers[i] = setInterval(()=> {
                            const d = document.querySelector(".c" + c)
                            let t = parseInt(d.innerHTML.split(" ")[0])
                            d.innerHTML = t + 1 + " seconds"
                        }, 1000)
                    } else {
                        clearInterval(timers[i])
                        const d = document.querySelector(".c" + c)
                        d.innerHTML = "0 seconds"
                    }
                })

                relaySwitch.appendChild(relayLabel)
                colDiv2.appendChild(relaySwitch)

                const relayDuration = document.createElement("div")
                relayDuration.classList.add("duration","c"+c)
                relayDuration.innerHTML = "0 seconds"

                colDiv3.appendChild(relayDuration)

            }
            return container
        }

        function actuateRelay(channel, state) {
            state == 1 ?
            console.log("Channel " + channel + " is activated!") :
            console.log("Channel " + channel + " is deactivated!")


// trigger digitalwrite to channel/gpio
           fetch("/actuaterelay", { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ "channel": channel, "state": state }) // should submit localStorage values
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data); 
                        // myVar.timerSetData = data.jsondata.timerSetData;
                        // localTimerSetData = structuredClone(myVar.timerSetData)
                        // timerSetData = myVar.timerSetData
                        // mydata2 = data;
                        // populateScheduleData(timerSetData)
                        // updateSchedule(timerSetData)    // doesn't work when div.schedule-container not mounted
                        // ntptime = data.ntptime
                    })
                    .catch(error => console.error(error))
        }

        function createChannelButtons() {
            for (let i = 0; i < 8; i++) {
                let div = document.createElement("div")
                div.classList.add("grid-item", "card")
                let channelBtn = document.createElement('div')
                channelBtn.innerHTML = i + 1
                channelBtn.classList.add("c" + (i + 1) + "on", "channel-btn")
                // select channel
                channelBtn.addEventListener("click", function () {
                    // save form values into local storage first before switching to clicked channel, and send all channels when submit button clicked
                    // TODO - done

                    animateChannelSwitching(".channel-btn-container", i + 1)
                    animateChannelSwitching(".daysLabel", i + 1)
                    animateChannelSwitching(".controlLabel", i + 1)
                    animateChannelSwitching(".startStopLabel", i + 1)
                    animateChannelSwitching(".timerset-container", i + 1)
                    animateChannelSwitching(".submitDiv", i + 1)

                    Array.from(document.querySelectorAll(".channel-btn")).forEach(btn => btn.style.opacity = 0.25)
                    this.style.opacity = 1.0
                    selectedChannel = this.innerHTML
                    // change input name to reference channel number
                    let inputList = document.querySelectorAll(".timerSet input")
                    inputList.forEach(input => {
                        input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                    })
                    // change input names to reference to selectedChannel
                    // once selected, load values from timerSetData object

                    inputList.forEach((input) => {
                        input.value = timerSetData[input.name]
                    })


                    let inputList2 = document.querySelectorAll(".timerset-data input")
                    inputList2.forEach(input => {
                        input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                    })
                    // change input names to reference to selectedChannel
                    // once selected, load values from timerSetData object

                    inputList2.forEach((input) => {
                        input.value = timerSetData[input.name]
                    })

                })
                div.appendChild(channelBtn)
                let channelBtnContainer = document.querySelector(".channel-btn-container")
                channelBtnContainer.appendChild(div)
            }
        }

        function animateChannelSwitching(clsName, chNum) {
            let elem = document.querySelector(clsName)
            let classes = elem.className.split(" ").filter(c => !c.endsWith("on"))
            elem.className = classes.join(" ").trim()
            elem.classList.add("c" + (chNum) + "on")
        }

        function createDescription() {
            const container = document.createElement("div")
            container.classList.add("container")

            const titlecontainer = document.createElement("div")
            titlecontainer.innerHTML = "<h1>Description</h1>"
            titlecontainer.classList.add("title")
            container.appendChild(titlecontainer)

            const descriptionArea = document.createElement("div")
            descriptionArea.classList.add("form-group")
            const label = document.createElement("label")
            label.setAttribute("for","notes")
            label.innerHTML = "Write your notes here:"
            const textArea = document.createElement("textarea")
            textArea.classList.add("form-control")
            textArea.rows = 16
            // textArea.maxLength = "5000"
            textArea.id = "notes"
            descriptionArea.appendChild(label)
            descriptionArea.appendChild(textArea)

            container.appendChild(descriptionArea)

            // <div class="form-group">
            // <label for="comment">Comment:</label>
            // <textarea class="form-control" rows="5" id="comment"></textarea>
            // </div> 

            const submitBtnDiv = document.createElement("div")
            submitBtnDiv.classList.add("timerset-submit-btn", "grid-item")
            container.appendChild(submitBtnDiv)

            const submitElement = document.createElement("button")
            submitElement.name = "submitBtn"
            submitElement.classList.add("submitBtn", "btn", "btn-light")
            submitElement.innerHTML = "Enter"

            submitBtnDiv.appendChild(submitElement)

            submitElement.onclick = (e) => postData(e)

            function postData(e) {
                // alert("clicked button, channel=" + selectedChannel)
                e.preventDefault()
                console.log("notes entered")

                notes = textArea.value

                fetch("/description_notes", { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ "notes": notes }) // should submit localStorage values
                })
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data); 
                        console.log(data.message.notes)
                        // textArea.value = data.message.notes
                    })
                    .catch(error => console.error(error))

            }

            fetch("/description_notes")
            .then(response => response.json())
            .then(data=> { 
                console.log(data.jsondata.notes)
                textArea.value = data.jsondata.notes
            })
            .catch(error=> console.error(error))

            return container
        }

        function createHelp() {
            const container = document.createElement("div")
            container.classList.add("container")

            const titlecontainer = document.createElement("div")
            titlecontainer.innerHTML = "<h1>Help</h1>"
            titlecontainer.classList.add("title")
            container.appendChild(titlecontainer)
            return container
        }

        let element1, element2, element3, element4, element5, element6

        function initialCheckInputValidity(input) {
            console.log("initialCheckInputValidity")
            if(input.value !== '') {
                        console.log(input.name)
                        if(input.name.endsWith("0")) {
                            let prefix = input.name.substring(0,input.name.length-1)
                            const that = document.querySelector("input." + prefix + "1")
                            console.log("input=" + input.value + " and that=" + that.value)
                            if(input.value < that.value) {
                                console.log("valid")
                                document.querySelector("input." + input.name).classList.remove("is-invalid")
                                document.querySelector("input." + that.name).classList.remove("is-invalid")
                                document.querySelector("input." + input.name).classList.add("is-valid")
                                document.querySelector("input." + that.name).classList.add("is-valid")
                            }
                            else {
                                console.log("invalid")
                                document.querySelector("input." + input.name).classList.remove("is-valid")
                                document.querySelector("input." + that.name).classList.remove("is-valid")
                                document.querySelector("input." + input.name).classList.add("is-invalid")
                                document.querySelector("input." + that.name).classList.add("is-invalid")
                            }
                        } else if(input.name.endsWith("1")) {
                            let prefix = input.name.substring(0,input.name.length-1)
                            const that = document.querySelector("input." + prefix + "0")
                            console.log("input=" + input.value + " and that=" + that.value)
                            if(input.value > that.value) {
                                console.log("valid")
                                document.querySelector("input." + input.name).classList.remove("is-invalid")
                                document.querySelector("input." + that.name).classList.remove("is-invalid")
                                document.querySelector("input." + input.name).classList.add("is-valid")
                                document.querySelector("input." + that.name).classList.add("is-valid")
                            }
                            else {
                                console.log("invalid")
                                document.querySelector("input." + input.name).classList.remove("is-valid")
                                document.querySelector("input." + that.name).classList.remove("is-valid")
                                document.querySelector("input." + input.name).classList.add("is-invalid")
                                document.querySelector("input." + that.name).classList.add("is-invalid")
                            }
                        }
                    }
        }

        function initCheckForm() {
            let inputList = document.querySelectorAll(".timerset-data input")
            console.log("here")
            inputList.forEach(input => {
                initialCheckInputValidity(input)
            })
        }

        function init(i) {
            console.log(myVar.timerSetData)
            element1 = createTimerSetRawSummary2(myVar.timerSetData)
            element2 = createSchedule(myVar.timerSetData)
            element3 = createTimerSetForm2(myVar.timerSetData)
            element4 = createTestRelays()
            element5 = createDescription()
            element6 = createHelp()

            // initCheckForm()
            // createTimerSetForm()
            // initChannelButtons()
        }

        function initChannelButtons() {
            createChannelButtons()

            animateChannelSwitching(".channel-btn-container", i + 1)
            animateChannelSwitching(".daysLabel", i + 1)
            animateChannelSwitching(".controlLabel", i + 1)
            animateChannelSwitching(".startStopLabel", i + 1)
            animateChannelSwitching(".timerset-container", i + 1)
            animateChannelSwitching(".submitDiv", i + 1)

            selectedChannel = i + 1
            // change input name to reference channel number
            let inputList = document.querySelectorAll(".timerSet input")
            inputList.forEach(input => {
                input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                // console.log("input.name=" + input.name)
            })

            let inputList2 = document.querySelectorAll(".timerset-data input")
            inputList2.forEach(input => {
                input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                // console.log("input.name=" + input.name)
            })
            // change input names to reference to selectedChannel
            // once selected, load values from timerSetData object

            fetch("/getTimerSetData").then((response => response.json())).then(data => {
                // console.log(data, data.timerSetData)
                timerSetData = data.timerSetData    // load params5.json into timerSetData 
                enterData(data.timerSetData)
            }).catch(error => console.error(error))

            function enterData(timerSetData) {
                inputList.forEach((input) => {
                    input.value = timerSetData[input.name]
                    // console.log("input.value=" + input.value)
                })
                // console.log("timerSetData=" + JSON.stringify(timerSetData))
                inputList2.forEach((input) => {
                    input.value = timerSetData[input.name]
                    // console.log("input.value=" + input.value)
                })
            }
        }
        // end second block

        function updateTime() {
            fetch('/get_time')
                .then(response => {
                    // console.log('Response:', response); 
                    return response.json()
                })
                .then(data => {
                    // console.log('Data:', data.time)
                    if (data.time !== null) {
                        const ntpTime = new Date(data.time * 1000)
                        console.log(ntpTime.toLocaleString())
                        // const options = {weekday:"long",year:"numeric",mont}
                        document.querySelector('.ntp-time').textContent = ntpTime.toLocaleString('en-US', { weekday: "long", year: "numeric", month: "short", day: "numeric", hour12: false, hour: "numeric", minute: "numeric", second: "numeric" }) //ntpTime.toUTCString()
                        checkTimerEvent(ntpTime)
                    }
                }).catch(error => console.error(error))
        }

        function checkTimerEvent(ntpTime) {
            let dow = ntpTime.getDay() // ntpTime.getUTCDay()
            let timeNow = ntpTime.toLocaleString('en-US', { hour12: false, hour: "numeric", minute: "numeric" })
            let _timeNow = timeNow.split(":")
            let rowNow = _timeNow[0] * 2 + (_timeNow[1] > 0 ? 1 : 0)
            // console.log("dow=" + dow + ", timeNow=" + timeNow + ", rowNow=" + rowNow)
            let dowCol = dow * 8 // number of relays = 8
            for (let i = dowCol; i < dowCol + 8; i++) {
                try {
                    document.querySelector(".schedule-data .col" + i + ".row" + rowNow).innerHTML = dow
                } catch(error) {
                    // console.error(error)
                }
            }
        }



        init(0) // channel 1 first on load
        // updateTime()
        setInterval(updateTime, 10 * 1000)
        // let heading = ge(".clock")
        // heading.innerHTML = "<h2>Channel Status @ {{ntptime}}</h2>"

    </script>

    <script>

        const summary = element1
        const schedule = element2 // update schedule where necessary since form may have been resubmitted
        const timerset = element3
        const testrelays = element4
        const description = element5
        const help = element6

        const routes = { // these are window.location.pathname too
            '/': summary,
            '/schedule': schedule,
            '/timerset': timerset,
            '/testrelays': testrelays,
            '/description': description,
            '/help': help
        }

        const rootDiv = document.querySelector('#root')
        // rootDiv.appendChild(routes['/'])
        rootDiv.appendChild(routes['/'])

        function onNavigate(pathname) {
            window.history.pushState(
                {page:pathname}, {}, window.location.origin + pathname
            )
            if (rootDiv.hasChildNodes())
                rootDiv.removeChild(rootDiv.children[0])
            rootDiv.appendChild(routes[pathname])
            if(pathname === "/schedule") {
                try {
                    updateSchedule(myVar.timerSetData)
                } catch (error) {

                }
            }

            if(pathname === "/timerset") {
                initCheckForm()
            }
        }

        window.onpopstate = (e) => {
            if (rootDiv.hasChildNodes())
                rootDiv.removeChild(rootDiv.children[0])
            
            rootDiv.appendChild(routes[window.location.pathname])
            if(e.state && e.state.page === "/schedule") {
                try {
                    updateSchedule(myVar.timerSetData)
                } catch (error) {

                }          
            }
        }

    </script>
</body>


</html>