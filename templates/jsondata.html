<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="application/json; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="data:,">
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVQI12P4//8/AAX+Av7czFnnAAAAAElFTkSuQmCC">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>Document</title>
</head>

<body>
    data values.....

    <div class="timersetrawsummary-top"></div>
    <br />
    <div class="clock">
        <h1>NTP Time Display</h1>
        <p>Time from NTP server: <span class="ntp-time">Loading...</span></p>
    </div>
    <br />
    <div class="channel-btn-container"></div>
    <div class="timerset-container"></div>
    <br />
    <div class="channel-selection-container">

        <!-- <ul class="nav nav-tabs">
            <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#home">Home</a></li>
            <li class="nav-item"><a class="nav-link"  data-toggle="tab" href="#about">About</a></li>
            <li class="nav-item"><a class="nav-link"  data-toggle="tab" href="#contact">Contact</a></li>
        </ul>

        <div class="tab-content">
            <div id="home" class="tab-panec active">
                <h3>Home</h3>
                <p>Some content</p>
            </div>
            <div id="about" class="tab-pane fade">
                <h3>About</h3>
                <p>About content</p>
            </div>
            <div id="contact" class="tab-pane fade">
                <h3>Contact</h3>
                <p>Contact content</p>
            </div>
        </div> -->

    </div>
        <!-- <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
              <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Home</button>
              <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Profile</button>
              <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Contact</button>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">home</div>
            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">profile</div>
            <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">contact</div>
          </div>        -->
    </div>
    <br />
    <div class="timerset2-container-top"></div>
    <br />
    <div class="schedule-container-top"></div>
    <!-- <div class="schedule2-container"></div> -->
    <!-- creating sample data grid and timer summary grid -->

    <div class="relay-container">
        <ul class="nav nav-tabs">
            <li class="nav-item"><a class="nav-link active" data-toggle="tab" onclick="onNavigate('/'); return false;">Home2</a></li>
            <li class="nav-item"><a class="nav-link" data-toggle="tab" onclick="onNavigate('/about'); return false;">About2</a></li>
            <li class="nav-item"><a class="nav-link" data-toggle="tab" onclick="onNavigate('/contact'); return false;">Contact2</a></li>
        </ul>
        <div id="root"></div>
    </div>

    <script>

        // channels 
        // c=0 -> col=0,8,16,24,32,40,48
        // c=1 -> col=1,9,17,25,33,41,49
        // c=2 -> col=2,10,18,26,34,42,50
        // c=3 -> col=3,11,19,27,35,43,51
        // c=4 -> col=4,12,20,28,36,44,52
        // c=5 -> col=5,13,21,29,37,45,53
        // c=6 -> col=6,14,22,30,38,46,54
        // c=7 -> col=7,15,23,31,39,47,55
        // d=0 -> col=0,1,2,3,4,5,6,7
        // d=1 -> col=8,9,10,11,12,13,14,15
        // d=2 -> col=16,17,18,19,20,21,22,23
        // d=3 -> col=24,25,26,27,28,29,30,31
        // d=4 -> col=32,33,34,35,36,37,38,39
        // d=5 -> col=40,41,42,43,44,45,46,47
        // d=6 -> col=48,49,50,51,52,53,54,55
        // p=0,1,2,3 -> 4 available periods
        // o=0,1 -> on,off channels

        myVar = myFunc({{jsondata|tojson}})
        function myFunc(vars){
            console.log("myFunc" + vars)
            return vars
        }

        let selectedChannel = "1"
        let timerSetData = {}

        // first block --- creating timerset raw summary

        function createTimerSetRawSummary() {

            const containerTop = document.querySelector(".timersetrawsummary-top")
            const grid = document.createElement("div")
            grid.classList.add("grid-container")
            containerTop.appendChild(grid)

            // this for loop may not be necessary anymore now that we have row col classes
            for (let i = 0; i < 448; i++) {
                let gridItem = document.createElement("div")
                gridItem.classList.add("grid-item")
                // gridItem.id = "x" + myMap(i)
                grid.appendChild(gridItem)
                // gridItem.classList.add("y" + i)
            }
            document.querySelectorAll(".grid-container .grid-item").forEach(((elem, key) => {
                row = Math.floor(key / 56)
                col = key % 56
                elem.classList.add("row" + row, "col" + col)
            }))

            console.log("populateFirstTableData")

            fetch("/getTimerSetData").then((response => response.json())).then(data => {
                console.log(data.timerSetData)
                timerSetData = data.timerSetData    // load params5.json into timerSetData 
                enterData(data.timerSetData)
            }).catch(error => console.error(error))

            function enterData(data) {
                Object.entries(data).forEach((entry) => {
                    const [key, value] = entry
                    // console.log(`${key}: ${value}`)

                    let t = key.split(/c(\d+)d(\d+)p(\d+)o(\d+)/).filter(n => n)
                    // console.log(t)
                    let c = t[0]
                    let d = t[1]
                    let p = t[2]
                    let o = t[3]
                    // let col = (parseInt(d)-0)*8+parseInt(c)-1 // number of relays=8, d=day of week, c=channel relay number
                    let col = (+d - 0) * 8 + +c - 1 // number of relays=8, d=day of week, c=channel relay number
                    // console.log(key + ', ' + col)
                    let row = +p * 2 + +o
                    // console.log(row)
                    let elem = document.querySelector(".grid-container .row" + row + ".col" + col)
                    elem.innerHTML = value
                    elem.classList.add("con")
                })
            }

            return grid
        }

        // end first block

        // third block --- creating schedule 

        function createChannelSelectionNavTabs() {
            const container = document.querySelector(".channel-selection-container")
            // const html = document.createElement("div")
            container.innerHTML=  '<nav>\
                                <div class="nav nav-tabs" id="nav-tab" role="tablist">\
                                <button class="nav-link active" id="nav-channel1-tab" data-bs-toggle="tab" data-bs-target="#nav-channel1" type="button" role="tab" aria-controls="nav-channel1" aria-selected="true">Channel1</button>\
                                <button class="nav-link" id="nav-channel2-tab" data-bs-toggle="tab" data-bs-target="#nav-channel2" type="button" role="tab" aria-controls="nav-channel2" aria-selected="false">Channel2</button>\
                                <button class="nav-link" id="nav-channel3-tab" data-bs-toggle="tab" data-bs-target="#nav-channel3" type="button" role="tab" aria-controls="nav-channel3" aria-selected="false">Channel3</button>\
                                </div>\
                            </nav>\
                            <div class="tab-content" id="nav-tabContent">\
                                <div class="tab-pane fade show active" id="nav-channel1" role="tabpanel" aria-labelledby="nav-channel1-tab">Channel1 Input Form</div>\
                                <div class="tab-pane fade" id="nav-channel2" role="tabpanel" aria-labelledby="nav-channel2-tab">Channel2 Input Form</div>\
                                <div class="tab-pane fade" id="nav-channel3" role="tabpanel" aria-labelledby="nav-channel3-tab">Channel3 Input Form</div>\
                            </div>'
            // container.innerHTML = html.innerHTML
        }
        // createChannelSelectionNavTabs()

        function createTimerSetForm2() {

            const containerTop = document.querySelector(".timerset2-container-top")
            const container = document.createElement("div")
            container.classList.add("timerset2-container")
            containerTop.appendChild(container)

            const timersetForm = document.createElement("form")
            timersetForm.classList.add("form-group")
            container.appendChild(timersetForm)

            const timersetControlLabel = document.createElement("div")
            timersetControlLabel.classList.add("timerset-control-label")
            timersetForm.appendChild(timersetControlLabel)

            const timersetDoW = document.createElement("div")
            timersetDoW.classList.add("timerset-dow")
            timersetForm.appendChild(timersetDoW)    

            const timersetStartStop = document.createElement("div")
            timersetStartStop.classList.add("timerset-start-stop")
            timersetForm.appendChild(timersetStartStop)

            const timersetData = document.createElement("div")
            timersetData.classList.add("timerset-data")
            timersetForm.appendChild(timersetData)

            const gridItem = document.createElement("div")
            gridItem.classList.add("grid-item")
            timersetControlLabel.appendChild(gridItem)
            gridItem.innerHTML = "Control"

            const timersetSubmitBtn = document.createElement("div")
            timersetSubmitBtn.classList.add("timerset-submit-btn", "grid-item")
            timersetForm.appendChild(timersetSubmitBtn)
            
            const dow = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            dow.forEach((d, i) =>{
                const gridItem = document.createElement("div")
                gridItem.classList.add("col"+ i, "grid-item")
                gridItem.innerHTML = d
                timersetDoW.appendChild(gridItem)
            })

            for (let i = 0; i < 8; i++) {
                const div = document.createElement("div")
                timersetStartStop.appendChild(div)
                div.classList.add("row" + (i), "grid-item")

                if (i % 2 == 0) div.innerHTML = "Start"
                if (i % 2 == 1) div.innerHTML = "Stop"
            }

            for (let c = 0; c < 7; c++) {
                for (let r = 0; r < 8; r++) {
                    const gridItem = document.createElement("div")
                    gridItem.classList.add("col" + c, "row" + r, "grid-item")
                    timersetData.appendChild(gridItem)

                    const input = document.createElement("input")
                    input.classList.add("input-sm", "form-control")
                    gridItem.appendChild(input)
                    input.type = "time"
                    let _c = selectedChannel
                    let _d = c
                    let _p = Math.floor(r / 2)
                    let _o = r % 2
                    if ((_o == 0)) {
                        input.name = "c" + _c + "d" + _d + "p" + _p + "o0"
                    } else {
                        input.name = "c" + _c + "d" + _d + "p" + _p + "o1"
                    }
                    input.addEventListener('change', function () {
                        timerSetData[this.name] = this.value
                    })
                }
            }

            const submitElement = document.createElement("button")
            submitElement.name = "submitBtn"
            submitElement.classList.add("submitBtn", "btn", "btn-light")
            submitElement.innerHTML = "Enter"

            timersetSubmitBtn.appendChild(submitElement)

            return container
        }

        function createSchedule(timerSetData) {

            const containerTop = document.querySelector(".schedule-container-top")
            const container = document.createElement("div")
            container.classList.add("schedule-container")
            containerTop.appendChild(container)

            const scheduleTimeLabel = document.createElement("div")
            scheduleTimeLabel.classList.add("schedule-time-label")
            container.appendChild(scheduleTimeLabel)

            const scheduleDoW = document.createElement("div")
            scheduleDoW.classList.add("schedule-dow")
            container.appendChild(scheduleDoW)

            const scheduleTime = document.createElement("div")
            scheduleTime.classList.add("schedule-time")
            container.appendChild(scheduleTime)

            const scheduleData = document.createElement("div")
            scheduleData.classList.add("schedule-data")
            container.appendChild(scheduleData)

            const gridItem = document.createElement("div")
            gridItem.classList.add("grid-item")
            scheduleTimeLabel.appendChild(gridItem)
            gridItem.innerHTML = "Time"

            const dow = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            dow.forEach((d, i) =>{
                const gridItem = document.createElement("div")
                gridItem.classList.add("col"+ i, "grid-item")
                gridItem.innerHTML = d
                scheduleDoW.appendChild(gridItem)
            })

            for(let t=0; t<48;t++) {
                const timeStr = Math.floor(t/2).toLocaleString('en-US', {minimumIntegerDigits:2,useGrouping:false}) + ":" + (t%2==0?"00":"30")
                const gridItem = document.createElement("div")
                gridItem.classList.add("row" + t, "grid-item")
                gridItem.innerHTML = timeStr
                scheduleTime.appendChild(gridItem)
            }

            const keys = Object.keys(timerSetData)
            const timerSetDataLength = Object.keys(timerSetData).length

            for (let c = 0; c < 56; c++) {
                const channel = c % 8 + 1
                const dow = Math.floor(c / 8)
                const pattern = "c" + channel + "d" + dow
                filteredData = filterData(timerSetData, pattern)
                const filteredDataKeys = Object.keys(filteredData)
                const filteredDataLength = Object.keys(filteredData).length

                // console.log(pattern + ", " + Object.keys(filteredData).length)
                for (let r = 0; r < 48; r++) {
                    const gridItem = document.createElement("div")
                    gridItem.classList.add("grid-item")
                    gridItem.classList.add("row" + r, "col" + c)
                    gridItem.classList.add("coff")
                    gridItem.on
                    // gridItem.innerHTML = channel
                    scheduleData.appendChild(gridItem)
                    if (filteredDataLength > 0) {
                        for (let i = 0; i < filteredDataLength; i = i + 2) {
                            const on = filteredData[filteredDataKeys[i]]
                            const off = filteredData[filteredDataKeys[i + 1]]
                            const timeStr = Math.floor(r / 2).toLocaleString('en-US', {
                                minimumIntegerDigits: 2, useGrouping: false
                            }) + ":" + (r % 2 == 0 ? "00" : "30")

                            if (timeStr >= on && timeStr < off) {
                                gridItem.classList.add("c" + channel + "on")
                                gridItem.classList.remove("coff")
                            }
                        }
                    }
                }
            }

            function filterData(inputData, substringToMatch) {

                // const inputData = {
                //     "timerSetData": {
                //         "c1d1p0o0": "08:00",
                //         "c1d1p0o1": "09:09",
                //         "c1d1p1o0": "10:00",
                //         "c1d1p1o1": "11:00",
                //         "c1d1p2o0": "11:00",
                //         "c1d1p2o1": "15:00",
                //         "c2d4p0o0": "04:00",
                //         "c2d4p0o1": "06:00",
                //         "c4d3p0o0": "07:00",
                //         "c4d3p0o1": "09:00",
                //         "c4d3p1o0": "17:00",
                //         "c4d3p1o1": "18:09"
                //     }
                // }
                // const substringToMatch = "c4d3"

                const filteredEntries = Object.entries(myVar.timerSetData).filter(([key, _]) => key.includes(substringToMatch))

                const filteredData = Object.fromEntries(filteredEntries)

                // console.log(filteredData)

                return filteredData
            }
            return container
        }

        // from chatgpt
        // function filterData(inputData, substringToMatch) {

        //     // const inputData = {
        //     //     "timerSetData": {
        //     //         "c1d1p0o0": "08:00",
        //     //         "c1d1p0o1": "09:09",
        //     //         "c1d1p1o0": "10:00",
        //     //         "c1d1p1o1": "11:00",
        //     //         "c1d1p2o0": "11:00",
        //     //         "c1d1p2o1": "15:00",
        //     //         "c2d4p0o0": "04:00",
        //     //         "c2d4p0o1": "06:00",
        //     //         "c4d3p0o0": "07:00",
        //     //         "c4d3p0o1": "09:00",
        //     //         "c4d3p1o0": "17:00",
        //     //         "c4d3p1o1": "18:09"
        //     //     }
        //     // }
        //     // const substringToMatch = "c4d3"

        //     const filteredEntries = Object.entries(myVar.timerSetData).filter(([key,_])=>key.includes(substringToMatch))

        //     const filteredData = Object.fromEntries(filteredEntries)

        //     // console.log(filteredData)

        //     return filteredData
        // }

        // filterData()

        // end third block

        // second block --- creating input table for timer set

        function createTimerSetForm() {
            let formElement = document.createElement("form")
            formElement.name = 'timerset'
            // formElement.method='POST'
            // formElement.action='/postdata'

            formElement.id = "myForm"
            let timerset = document.querySelector(".timerset-container")

            timerset.appendChild(formElement)

            timerSetElement = document.createElement("div")
            timerSetElement.classList.add("card-holder", "timerSet")
            // timerSetElement.id = "timerSet"
            formElement.appendChild(timerSetElement)


            daysLabelElement = document.createElement("div")
            daysLabelElement.classList.add("card-holder","daysLabel")
            formElement.appendChild(daysLabelElement)

            // const gridItem = document.createElement("div")
            // gridItem.classList.add("grid-item","card")
            // scheduleTimeLabel.appendChild(gridItem)
            // gridItem.innerHTML = "Control"

            timersetDoW = document.querySelector(".timerset-container .daysLabel")
            const dow = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            dow.forEach((d, i) =>{
                const gridItem = document.createElement("div")
                gridItem.classList.add("col"+ i, "grid-item","card")
                gridItem.innerHTML = d
                timersetDoW.appendChild(gridItem)
            })

            controlLabelElement = document.createElement("div")
            controlLabelElement.classList.add("card-holder","controlLabel")
            formElement.appendChild(controlLabelElement)
            elem2 = document.createElement("div")
            controlLabelElement.appendChild(elem2)
            elem2.innerHTML = "Control"
            elem2.classList.add("card")

            startStopLabelElement = document.createElement("div")
            startStopLabelElement.classList.add("startStopLabel","card-holder")
            formElement.appendChild(startStopLabelElement)
            /*         */

            for (let i = 0; i < 8; i++) {
                let div = document.createElement("div")
                div.classList.add("card")
                startStopLabelElement.appendChild(div)
                div.classList.add("row" + (i))

                if (i % 2 == 0) div.innerHTML = "Start"
                if (i % 2 == 1) div.innerHTML = "Stop"

            }
            // creating input elements for entering start and stop times. remember to include name attribute to use json format


            // col by col per channel
            for (let i = 0; i < 56; i++) {
                let inputdiv = document.createElement("div")
                inputdiv.classList.add("card")
                inputdiv.classList.add("col" + (Math.floor(i / 8)))
                inputdiv.classList.add("row" + (i % 8))
                timerSetElement.appendChild(inputdiv)
                let input = document.createElement("input")
                inputdiv.appendChild(input)
                input.type = "time"

                let _c = selectedChannel
                let _d = Math.floor(i / 8)
                let _p = (Math.floor(i / 2)) % 4
                let _o = i % 2
                if ((i % 2 == 0)) {
                    input.name = "c" + _c + "d" + _d + "p" + _p + "o0"
                } else {
                    input.name = "c" + _c + "d" + _d + "p" + _p + "o1"
                }
                let inputdivlabel = document.createElement("div")
                // inputdivlabel.innerHTML=i
                inputdivlabel.classList.add("inputlabel")
                inputdiv.appendChild(inputdivlabel)

                input.addEventListener('change', function () {
                    timerSetData[this.name] = this.value
                })
            }

            // create submit button for form
            let divElement = document.createElement("div")
            divElement.classList.add("submitDiv")
            formElement.appendChild(divElement)


            // https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit
            // A form control (such as a submit button) with a name or id of submit will mask the form's submit method. Trying to call myForm.submit(); throws an error "submit is not a function" because in this case submit refers to the form control which has a name or id of submit.

            let submitElement = document.createElement("button")
            submitElement.name = "submitBtn"
            submitElement.classList.add("submitBtn")
            submitElement.classList.add("btn", "btn-light")
            submitElement.innerHTML = "Enter"

            divElement.appendChild(submitElement)

            submitElement.onclick = (e) => postData(e)

            function postData(e) {
                // alert("clicked button, channel=" + selectedChannel)
                e.preventDefault()

                fetch("/jsondata/", { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ "timerSetData": timerSetData }) })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data); timerSetData = data.jsondata.timerSetData; mydata2 = data; populateScheduleData(timerSetData)
                        ntptime = data.ntptime
                    })
                    .catch(error => console.error(error))

            }

            return formElement

        }

        function createChannelButtons() {
            for (let i = 0; i < 8; i++) {
                let div = document.createElement("div")
                div.classList.add("grid-item", "card")
                let channelBtn = document.createElement('div')
                channelBtn.innerHTML = i + 1
                channelBtn.classList.add("c" + (i + 1) + "on", "channel-btn")
                // select channel
                channelBtn.addEventListener("click", function () {
                    // save form values into local storage first before switching to clicked channel, and send all channels when submit button clicked
                    // TODO - done

                    animateChannelSwitching(".channel-btn-container", i + 1)
                    animateChannelSwitching(".daysLabel", i + 1)
                    animateChannelSwitching(".controlLabel", i + 1)
                    animateChannelSwitching(".startStopLabel", i + 1)
                    animateChannelSwitching(".timerset-container", i + 1)
                    animateChannelSwitching(".submitDiv", i + 1)

                    Array.from(document.querySelectorAll(".channel-btn")).forEach(btn => btn.style.opacity = 0.25)
                    this.style.opacity = 1.0
                    selectedChannel = this.innerHTML
                    // change input name to reference channel number
                    let inputList = document.querySelectorAll(".timerSet input")
                    inputList.forEach(input => {
                        input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                    })
                    // change input names to reference to selectedChannel
                    // once selected, load values from timerSetData object

                    inputList.forEach((input) => {
                        input.value = timerSetData[input.name]
                    })


                            let inputList2 = document.querySelectorAll(".timerset-data input")
                            inputList2.forEach(input => {
                                input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                            })
                            // change input names to reference to selectedChannel
                            // once selected, load values from timerSetData object

                            inputList2.forEach((input) => {
                                input.value = timerSetData[input.name]
                            })

                })
                div.appendChild(channelBtn)
                let channelBtnContainer = document.querySelector(".channel-btn-container")
                channelBtnContainer.appendChild(div)
            }
        }

        function animateChannelSwitching(clsName, chNum) {
            let elem = document.querySelector(clsName)
            let classes = elem.className.split(" ").filter(c => !c.endsWith("on"))
            elem.className = classes.join(" ").trim()
            elem.classList.add("c"+(chNum)+"on")
        }

        let element1, element2, element3

        function init(i) {
            element1 = createTimerSetRawSummary()
            element2 = createSchedule(myVar.timerSetData)
            element3 = createTimerSetForm2()
            createTimerSetForm()


            createChannelButtons()

            animateChannelSwitching(".channel-btn-container", i + 1)
            animateChannelSwitching(".daysLabel", i + 1)
            animateChannelSwitching(".controlLabel", i + 1)
            animateChannelSwitching(".startStopLabel", i + 1)
            animateChannelSwitching(".timerset-container", i + 1)
            animateChannelSwitching(".submitDiv", i + 1)

            selectedChannel = i + 1
            // change input name to reference channel number
            let inputList = document.querySelectorAll(".timerSet input")
            inputList.forEach(input => {
                input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                // console.log("input.name=" + input.name)
            })

                    let inputList2 = document.querySelectorAll(".timerset-data input")
                    inputList2.forEach(input => {
                        input.name = input.name.replace(/c\d+d/, 'c' + selectedChannel + 'd')
                        // console.log("input.name=" + input.name)
                    })
            // change input names to reference to selectedChannel
            // once selected, load values from timerSetData object

            fetch("/getTimerSetData").then((response=>response.json())).then(data=>{
                // console.log(data, data.timerSetData)
                timerSetData = data.timerSetData    // load params5.json into timerSetData 
                enterData(data.timerSetData)
            }).catch(error=>console.error(error))

            function enterData(timerSetData) {
                inputList.forEach((input) => {
                    input.value = timerSetData[input.name]
                    // console.log("input.value=" + input.value)
                })
                // console.log("timerSetData=" + JSON.stringify(timerSetData))
                        inputList2.forEach((input) => {
                            input.value = timerSetData[input.name]
                            // console.log("input.value=" + input.value)
                        })
            }
        }
        // end second block

        function updateTime() {
            fetch('/get_time')
            .then(response=>{
                // console.log('Response:', response); 
                return response.json()})
            .then(data=>{
                // console.log('Data:', data.time)
                if(data.time!==null) {
                    const ntpTime = new Date(data.time * 1000)
                    console.log(ntpTime.toLocaleString())
                    // const options = {weekday:"long",year:"numeric",mont}
                    document.querySelector('.ntp-time').textContent = ntpTime.toLocaleString('en-US', { weekday: "long",year:"numeric",month:"short",day:"numeric", hour12: false, hour: "numeric", minute: "numeric",second:"numeric"}) //ntpTime.toUTCString()
                    checkTimerEvent(ntpTime)
                }
            }).catch(error=>console.error(error))
        }

        function checkTimerEvent(ntpTime) {
            let dow = ntpTime.getDay() // ntpTime.getUTCDay()
            let timeNow = ntpTime.toLocaleString('en-US', { hour12: false, hour: "numeric", minute: "numeric"})
            let _timeNow = timeNow.split(":")
            let rowNow = _timeNow[0] * 2 + (_timeNow[1] > 0 ? 1 : 0) 
            // console.log("dow=" + dow + ", timeNow=" + timeNow + ", rowNow=" + rowNow)
            let dowCol = dow*8 // number of relays = 8
            for(let i=dowCol; i<dowCol+8; i++) {
                document.querySelector(".schedule-data .col" + i + ".row" + rowNow).innerHTML = dow
            }
        }



        init(0) // channel 1 first on load
        // updateTime()
        setInterval(updateTime, 10*1000)
        // let heading = ge(".clock")
        // heading.innerHTML = "<h2>Channel Status @ {{ntptime}}</h2>"

    </script>

<script>

    const home = element1
    const about = element2
    const contact = element3

    const routes = {
        '/': home,
        '/about': about,
        '/contact': contact
    }

    const rootDiv = document.querySelector('#root')
    // rootDiv.appendChild(routes['/'])

    function onNavigate(pathname) {
        window.history.pushState(
            {}, pathname, window.location.pathname
        )
        rootDiv.removeChild(rootDiv.children[0])
        rootDiv.appendChild(routes[pathname])
    }

    window.onpopstate = () => {
        rootDiv.removeChild(rootDiv.children[0])
        rootDiv.appendChild(routes[window.location.pathname])
    }
    
</script>
</body>


</html>